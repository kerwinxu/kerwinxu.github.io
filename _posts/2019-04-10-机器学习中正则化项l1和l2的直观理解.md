---
title: "机器学习中正则化项L1和L2的直观理解"
date: "2019-04-10"
categories: 
  - "数学"
---

机器学习中几乎都可以看到损失函数后面会添加一个额外项，常用的额外项一般有两种， 中文称作 L1正则化 和 L2正则化，或者 L1范数 和 L2范数。

L1正则化和L2正则化可以看做是损失函数的惩罚项。所谓『惩罚』是指对损失函数中的某些参数做一些限制。对于线性回归模型，使用L1正则化的模型建叫做Lasso回归，使用L2正则化的模型叫做Ridge回归（岭回归）。下图是Python中Lasso回归的损失函数

$$\\underset{w}{min}\\frac{1}{2n\_{sample}}||Xw-y||\_2^2+a||w||\_1$$

上边的$latex a||w||1$就是L1正则化项。

下图是Python中Ridge回归的损失函数，

$$\\underset{w}{min}||Xw-y||\_2^2+a||w||\_2^2$$

上边的$latex a||w||\_2^2$就是L2正则化项

一般回归分析中回归w表示特征的系数，从上式可以看到正则化项是对系数做了处理（限制）。L1正则化和L2正则化的说明如下：

- L1正则化是指权值向量w 中各个元素的绝对值之和，通常表示为$latex ||w||\_1$​
- L2正则化是指权值向量w 中各个元素的平方和然后再求平方根（可以看到Ridge回归的L2正则化项有平方符号），通常表示为$latex a||w||\_2^2$ ​

一般都会在正则化项之前添加一个系数，Python中用$latex \\alpha$表示，一些文章也用$latex \\lambda$表示。这个系数需要用户指定。

那添加L1和L2正则化有什么用？下面是L1正则化和L2正则化的作用，这些表述可以在很多文章中找到。

- L1正则化可以产生稀疏权值矩阵，即产生一个稀疏模型，可以用于特征选择
- L2正则化可以防止模型过拟合（overfitting）；一定程度上，L1也可以防止过拟合

L1和L2正则化的直观理解 这部分内容将解释为什么L1正则化可以产生稀疏模型（L1是怎么让系数等于零的），以及为什么L2正则化可以防止过拟合。

##L1正则化和特征选择 假设有如下带L1正则化的损失函数： $$J= J\_0 + \\alpha \\sum\_w{|w|} $$

其中$latex J\_0$是原始的损失函数，加号后面的一项是L1正则化项，$latex \\alpha$是正则化系数。注意到L1正则化是权值的绝对值之和，J 是带有绝对值符号的函数，因此J是不完全可微的。机器学习的任务就是要通过一些方法（比如梯度下降）求出损失函数的最小值。当我们在原始损失函数$latex J\_0$ 后添加L1正则化项时，相当于对$latex J\_0$做了一个约束。令$latex L = \\alpha \\sum\_w{|w|}$ ,则 $latex J = J\_0 + L $,此时我们的任务变成在L约束下求出$latex   J\_0 $取最小值的解。考虑二维的情况，即只有两个权$latex w^1$和$latex w^2$，此时$latex L = |w^1|+|w^2|$,对于梯度下降法，求解$latex J\_0$的过程可以画出等值线，同时L1正则化的函数L也可以在$latex w^1w^2 $的二维平面上画出来。如下图：

[![](images/20160904184428459.png)](http://127.0.0.1/wp-content/uploads/2019/04/20160904184428459.png)

 

图1 L1正则化

图中等值线是$latex J\_0$的等值线，黑色方形是L函数的图形。在图中，当$latex J\_0$等值线与L图形首次相交的地方就是最优解。上图中$latex J\_0$与L在L的一个顶点处相交，这个顶点就是最优解。注意到这个顶点的值是$latex (w^1, w^2) = (0, w)$可以直观想象，因为L函数有很多『突出的角』（二维情况下四个，多维情况下更多），$latex J\_0$与这些角接触的机率会远大于与L其它部位接触的机率，而在这些角上，会有很多权值等于0，这就是为什么L1正则化可以产生稀疏模型，进而可以用于特征选择。

而正则化前面的系数$latex \\alpha$，可以控制L图形的大小。$latex \\alpha$越小，L 的图形越大（上图中的黑色方框）；$latex \\alpha$越大，L的图形就越小，可以小到黑色方框只超出原点范围一点点，这是最优点的值$latex (w1,w2)=(0,w)$中的w可以取到很小的值。

类似，假设有如下带L2正则化的损失函数： $$ J = J\_0 + \\alpha \\sum\_w{w^2} $$

同样可以画出他们在二维平面上的图形，如下：

 

[![](images/20160904184646963.png)](http://127.0.0.1/?attachment_id=2338) 图2 L2正则化

二维平面下L2正则化的函数图形是个圆，与方形相比，被磨去了棱角。因此$latex J\_0$与L相交时使得 $latex w^1 或w^2 $等于零的机率小了许多，这就是为什么L2正则化不具有稀疏性的原因。

L2正则化和过拟合 拟合过程中通常都倾向于让权值尽可能小，最后构造一个所有参数都比较小的模型。因为一般认为参数值小的模型比较简单，能适应不同的数据集，也在一定程度上避免了过拟合现象。可以设想一下对于一个线性回归方程，若参数很大，那么只要数据偏移一点点，就会对结果造成很大的影响；但如果参数足够小，数据偏移得多一点也不会对结果造成什么影响，专业一点的说法是『抗扰动能力强』。

那为什么L2正则化可以获得值很小的参数？

以线性回归中的梯度下降法为例。假设要求的参数为$latex \\theta $，$latex h\_\\theta(x)$是我们的假设函数。线性回归一般使用平方差损失函数。单个样本的平方差是$latex (h\_\\theta(x) - y)^2$，如果考虑所有样本，损失函数是对每个样本的平方差求和，假设有m个样本，线性回归的代价函数如下，为了后续处理方便，乘以一个常数$latex \\frac{1}{2m} $：

$$ J(\\theta) = \\frac{1}{2m}\\sum\_{i=1}^{m}(h\_\\theta(x^{(i)}) - y^{(i)})^2$$

在梯度下降算法中，需要先对参数求导，得到梯度。梯度本身是上升最快的方向，为了让损失尽可能小，沿梯度的负方向更新参数即可。

对于单个样本，先对某个参数$latex \\theta\_j$求导：

$$ \\frac{\\partial}{\\partial \\theta\_j} J(\\theta) = \\frac{1}{m} (h\_\\theta(x) - y) \\frac{\\partial}{\\partial \\theta\_j} h\_\\theta(x)$$

注意到$latex h\_\\theta(x)$的表达式是$latex h\_\\theta(x)=\\theta\_0 x\_0 + \\theta\_1 x\_1 + \\dots + \\theta\_n x\_n$ . 单个样本对某个参数$latex \\theta\_j$求导，$latex \\frac{\\partial}{\\partial \\theta\_j} h\_\\theta(x) = x\_j $

. 最终式结果如下：

$$ \\frac{\\partial}{\\partial \\theta\_j} J(\\theta) = \\frac{1}{m} (h\_\\theta(x) - y) x\_j $$

在考虑所有样本的情况，将每个样本对$latex \\theta\_j$的导数求和即可，得到下式：

$$\\frac{\\partial}{\\partial \\theta\_j} J(\\theta) = \\frac{1}{m} \\sum\_{i=1}^m (h\_\\theta(x^{(i)}) - y^{(i)}) x\_j^{(i)} $$

梯度下降算法中，为了尽快收敛，会沿梯度的负方向更新参数，因此在式前添加一个负号，并乘以一个系数$latex \\alpha$（即学习率），得到最终用于迭代计算参数$latex \\theta\_j$的形式：

$$ \\theta\_j := \\theta\_j - \\alpha \\frac{1}{m}\\sum\_{i=1}^{m}(h\_\\theta(x^{(i)}) - y^{(i)})x\_j^{(i)} \\tag{4}$$

其中$latex \\alpha$是learning rate. 上式是没有添加L2正则化项的迭代公式，如果在原始代价函数之后添加L2正则化，则迭代公式会变成下面的样子： $$ \\theta\_j := \\theta\_j(1-\\alpha \\frac{\\lambda}{m}) - \\alpha \\frac{1}{m}\\sum\_{i=1}^{m}(h\_\\theta(x^{(i)}) - y^{(i)})x\_j^{(i)} \\tag{5}$$ 其中$latex \\lambda$就是正则化参数。从上式可以看到，与未添加L2正则化的迭代公式相比，每一次迭代，$latex \\theta\_j$都要先乘以一个小于1的因子，从而使得$latex \\theta\_j$不断减小，因此总得来看，$latex \\theta$是不断减小的。

最开始也提到L1正则化一定程度上也可以防止过拟合。之前做了解释，当L1的正则化系数很小时，得到的最优解会很小，可以达到和L2正则化类似的效果。

正则化参数的选择 L1正则化参数 通常越大的$latex \\lambda $可以让代价函数在参数为0时取到最小值。下面是一个简单的例子，这个例子来自Quora上的问答。为了方便叙述，一些符号跟这篇帖子的符号保持一致。

假设有如下带L1正则化项的代价函数： $$F(x) = f(x) + \\lambda ||x||\_1$$ 其中x是要估计的参数，相当于上文中提到的w以及$latex \\theta$. 注意到L1正则化在某些位置是不可导的，当λ$latex \\lambda$足够大时可以使得F(x)在x=0 时取到最小值。如下图：

[![](images/20160904184802668.png)](http://127.0.0.1/?attachment_id=2339) 图3 L1正则化参数的选择

分别取$latex \\lambda = 0.5$和$latex \\lambda = 2$，可以看到越大的$latex \\lambda$越容易使F(x)在x=0 时取到最小值。

L2正则化参数 从公式5可以看到，$latex \\lambda$越大，$latex \\theta\_j$衰减得越快。另一个理解可以参考图2，$latex \\lambda$越大，L2圆的半径越小，最后求得代价函数最值时各参数也会变得很小。

Reference 过拟合的解释： https://hit-scir.gitbooks.io/neural-networks-and-deep-learning-zh\_cn/content/chap3/c3s5ss2.html

正则化的解释： https://hit-scir.gitbooks.io/neural-networks-and-deep-learning-zh\_cn/content/chap3/c3s5ss1.html

正则化的解释： http://blog.csdn.net/u012162613/article/details/44261657

正则化的数学解释（一些图来源于这里）： http://blog.csdn.net/zouxy09/article/details/24971995

 

本文转载自  ： [https://blog.csdn.net/jinping\_shi/article/details/52433975](https://blog.csdn.net/jinping_shi/article/details/52433975)
