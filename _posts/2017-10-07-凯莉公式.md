---
layout: post
title: "凯莉公式"
date: "2017-10-07"
categories: ["金融", "资金管理"]
---

维基百科上写的：

计算方法：

$$ f=\\frac{p\\cdot r\_w-(1-p)\\cdot r\_l}{r\_w\\cdot r\_l} $$

$$ 或者写成 f = \\frac{p}{r\_l} - \\frac{1-p}{r\_w} $$

- $latex f $ 是最优的下注比例
- $latex p $ 是赢的概率
- $latex r\_w $ 为赢的净收益率
- $latex r\_l $ 为输的净收益率

公式中

f = 应该放入投注的资本比值

p = 获胜的概率

q = 失败的概率

b = 赔率

 

如下的公式更容易记住

$$ f = \\frac{b\\cdot p-q}{b} $$

这种条件是输的话，是输了全部投入（非本金）

- $latex b\\cdot p - q $ 是赢的期望
    - $latex b $ 是静赔率，是赢了的静回报的b倍，
        - 该投资者的本金为N，投注比例为f，则赢了是 $latex N \* (1+b\\cdot f ) $ ，输了的话是$latex N \* (1-f) $
    - $latex p $ 为赢的概率
    - $latex q $ 为输的概率
    - 当期望不是正数，就失去了投资的意义。

John Kelly的理论是这样的，对于有一定private wire的赛马人来说，第一个自然的想法当然是放入全部的资金，但是这样就会造成万一输掉血本无归的惨境。而在Kelly想要解决的这个问题中，在任何一个时刻输掉全部资金显然是不符合最大化累积收益的需求的。

真正应该关心的是长期累积的收入(compounding return)，对于累积的收益来说，最后的结果只和输赢的局数有关，而和输赢的顺序无关。所以他推出了一个最佳的投入仓位比，来最大化长期的累积收益：

bet = edge / odds = 预期获益／获益回报

这里的edge 在赌博中可以理解为 获胜的概率＊赔率 - 失败的概率，**当edge的数字为正的时候，这就是值得下注的比赛，而edge为0或者负数的情况说明赌徒不具备edge, 不应该下注（applies to most of games in casino)**

而odds则是赔率，**我们更可以把它理解为一种公众对概率的估计，是公开的消息。**

股票中的凯莉公式：

f\*=(p\*rW\-q\*rL)/rW 或者写成

f\*=p-(1-p)/（rW/rL） 其中f\*,p,q同上，rW是获胜后的净赢率，rL是净损失率，rW/rL是盈亏比。

比如，我有1万元买股票，30%幅度止盈，10%的幅度止损，最多盈利3000，最多亏损1000，这里rW\=0.3，rL\=0.1，此时可以计算最优仓位，但是由第一个公式是算不到的，主要原因是这里我并没有投入所有本金。

换句话说，第一个公式不过是第二个公式里rL\=100%的情形。

 

一个赌局，如果胜算占有，那该如何下注才能做到，风险最小，盈利最大呢？答案就是凯利公式。

 盈利概率80%，盈利金额为2元。

 亏损概率为20%，亏损额为1元（本金亏光）。

 那么下注金额（实际上就是投资组合的仓位控制）为多少呢？

 公式：（期望报酬率）/（赔率）

公式：（盈利概率×盈利金额-亏损概率×亏损额）/（盈利额 / 亏损额）

 合理的下注金额应该为本金为70%的比率，也就是如果有10元，应该下注7元。

 80%的概率，简单来讲，就是5局中有一局是亏损，其中四局盈利。

 

80% 2    20% 1   

0.7    

 

1 100 35 0 65 2 65 35 70 100 3 100 35 70 135 4 135 35 70 170 5 170 35 70 205

 

1 100 35 70 135 2 135 35 70 170 3 170 35 70 205 4 205 35 70 240 5 240 35 0 205         1 100 35 70 135 2 135 35 70 170 3 170 35 0 135 4 135 35 70 170 5 170 35 70 205

从上述推理数据看，凯利公式的神奇之处就在于，这个下注在任何亏损的情况下，都不会亏损，而且经过5局比赛后，结局都是205元（加入最初投入100元）。其他任何比率的下注比率，最终的结果都是要比205元少。只有70%的仓位控制比率是最优的。

长期来讲：孤注一掷下注和低比例下注方法都是错误。

 那么股票投资中跟赌场下注有什么区别吗？

 其实，策略是没有什么区别。

 

玩家（投资者）本质上的策略都是要注意两点：

一、判断赌局（或者是投资标的物）盈利的概率；

二、按概率来下注。对自己有利的时候下合理的筹码。

 

凯利公式的本质就是，如果概率对玩家（投资者）有利的时候，下注，对于玩家不利的时候，不玩。

 在赌场很难如此下注，但在证券市场中，却是要不玩的话，没人会来逼我们的。所以应该是说证券市场对于能够合理利用凯利公式来获利的人应该是机会更多。理论上上无穷的。也怪不得，申农、索普这些科学家都能够在证券市场中成为常胜将军啊。

 申农、一个科学家，一个数学天才，却在30多年的股市投资生涯中，年复合增长率达到了29%，比巴菲特还要高。只可惜申农没有留下任何投资策略和决策过程的思考的任何书籍。可惜。。。

 赌博和投资的区别就在于如何来判断盈利的概率。

我想判断投资盈利的概率还是应该从本质上来看，

如果是赌博，通过计算剩下牌中对玩家从概率上来说是否有利。

如果是投资个股的，应该看该公司的未来利润增长的可持续性和可能性有多大，能够增长多少？

如果是投资指数的，应该看指数的市盈率是多少，回绕合理的市盈率来判断概率，并合理下注，这个是最容易的一种下注方法。假如指数合理市盈率应该为25倍，那么在平均市盈率在25以下的时候，提高仓位，25倍以上，减低仓位。

 

一个更现实的情况是：

假如能够找到一个股票，未来增长1倍的可能性比较大（假如为70%），而亏损一半的可能性为（30%），合理的期望报酬率应该为：70%×1-30%×0.5=55%，也就是期望报酬率为55%，那么合理的下注金额应该为多少呢？根据开率公式计算：55%/（1/0.5)=27%，应该用27%的资金买入该股票，如果你能找5只这样的股票，那基本上就可以做一个组合了。整个组合的期望报酬率为55%左右了。一个很理想的投资组合。风险可控，赢利最优。

 

\==============================

凯利公式是一条可应用在投资资金和赌注的公式。应用于多次的随机赌博游戏，资金的期望增长率最高，且永远不会导致完全损失所有资金的后果。它假设赌博可无限次进行，而且没有下注上下限。

　　![f^* = \frac{bp-q}{b}]

- _f_ \* = 现有资金应进行下次投注的比例

- b = 赔率

- p = 胜利机会

- q = 输的机会 （一般等于 1-p ）

   赔率＝期望盈利/可能亏损

例如：若一个游戏有40%（p=0.40）机会胜出，赔率为2:1（b=2），这个赌客便应每次投注(2 × 0.40 - 0.60)/2 = 10%的资金。

这条公式是[克劳德·艾尔伍德·香农](http://wiki.mbalib.com/w/index.php?title=%E5%85%8B%E5%8A%B3%E5%BE%B7%C2%B7%E8%89%BE%E5%B0%94%E4%BC%8D%E5%BE%B7%C2%B7%E9%A6%99%E5%86%9C&action=edit "克劳德·艾尔伍德·香农")在[贝尔实验室](http://wiki.mbalib.com/wiki/%E8%B4%9D%E5%B0%94%E5%AE%9E%E9%AA%8C%E5%AE%A4 "贝尔实验室")的同事物理学家[约翰·拉里·凯利](http://wiki.mbalib.com/w/index.php?title=%E7%BA%A6%E7%BF%B0%C2%B7%E6%8B%89%E9%87%8C%C2%B7%E5%87%AF%E5%88%A9&action=edit "约翰·拉里·凯利")在1956年提出的。凯利的方法参考了香农关于长途电话线的嘈音的工作。凯利说明香农的[信息论](http://wiki.mbalib.com/wiki/%E4%BF%A1%E6%81%AF%E8%AE%BA "信息论")可应用于此：赌徒不必要获得完全的资讯。香农的另一位同事Edward O. Thorp应用这条公式在廿一点和[股票市场](http://wiki.mbalib.com/wiki/%E8%82%A1%E7%A5%A8%E5%B8%82%E5%9C%BA "股票市场")上。1738年丹尼·伯努利曾提出等价的观点，可是伯努利的文章直到1954年才首次译成英语。不过对于只投资一次的人来说，应选择算术平均最高的[投资组合](http://wiki.mbalib.com/wiki/%E6%8A%95%E8%B5%84%E7%BB%84%E5%90%88 "投资组合")。

\==================================================

优化模式之一：来源《巴菲特的投资组合》，这个比上面的简单，实用。http://www.fx998.cn6 D# X2 a& R' \_4 d. Y! r% u- d% z 2Ｐ-1＝Ｘ

Ｐ＝成功的概率

Ｘ＝投入的资金百分比
